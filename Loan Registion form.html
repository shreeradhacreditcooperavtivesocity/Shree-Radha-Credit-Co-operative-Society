<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loan Dashboard ‚Äî SRCCS</title>
<style>
/* Body & Headings */
body { 
  font-family: 'Poppins', sans-serif; 
  background:#eef2f7; 
  padding:20px; 
  color:#333;
  margin:0;
}
h2 { color:#1a202c; margin-bottom:15px; }
h3 { margin-bottom:10px; color:#2d3748; }

/* Toggle Button */
.toggle-btn {
  background:#007bff; 
  color:white; 
  border:none;
  padding:10px 15px; 
  border-radius:6px;
  cursor:pointer;
  transition:0.3s;
  margin-bottom:15px;
}
.toggle-btn:hover { background:#0056b3; }

/* Form */
form {
  background:#fff; 
  padding:25px; 
  border-radius:12px; 
  box-shadow:0 4px 12px rgba(0,0,0,0.1); 
  margin-bottom:25px;
}
.form-row {
  display:flex; 
  gap:15px; 
  flex-wrap:wrap; 
  margin-bottom:15px;
}
.form-group {
  flex:1; 
  display:flex; 
  flex-direction:column;
}
label { font-weight:500; margin-bottom:5px; }
input {
  padding:12px; 
  border:1px solid #ccc; 
  border-radius:6px; 
  width:100%;
  box-sizing:border-box;
  transition:0.3s;
}
input:focus { border-color:#007bff; outline:none; }

/* Buttons */
button { padding:10px 15px; border:none; border-radius:6px; cursor:pointer; color:white; transition:0.3s; }
button:hover { opacity:0.9; }
button[type="submit"] { background:#28a745; }
button.reject { background:#dc3545; }

/* Search Box */
.search-box { display:flex; gap:10px; margin-bottom:15px; }
.search-box input { flex:1; padding:12px; border-radius:6px; border:1px solid #ccc; }

/* Table */
table {
  width:100%; 
  border-collapse:collapse; 
  margin-top:10px;
  background:white;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 2px 10px rgba(0,0,0,0.05);
}
th, td { padding:12px 10px; text-align:left; border-bottom:1px solid #eee; }
th { background:#f7fafc; font-weight:600; color:#2d3748; }
tr:hover { background:#f1f5f9; }

/* Action Buttons in Table */
button.action-btn { padding:6px 12px; margin-right:5px; border:none; border-radius:6px; cursor:pointer; color:white; }
button.approve { background:#28a745; }
button.reject { background:#dc3545; }

/* Responsive */
@media(max-width:768px){
  .form-row { flex-direction:column; }
  table, th, td { font-size:14px; }
}
</style>
</head>
<body>

<h2>Loan Dashboard ‚Äî SRCCS</h2>
<button class="toggle-btn" id="toggleFormBtn">üìã Register New Loan</button>

<form id="loanForm" style="display:none;">
  <h3>Loan Registration Form</h3>
  <div class="form-row">
    <div class="form-group"><label>Full Name</label><input type="text" id="name" required></div>
  </div>
  <div class="form-row">
    <div class="form-group"><label>Aadhaar Number</label><input type="text" id="aadhaar" pattern="\d{12}" maxlength="12" required></div>
    <div class="form-group"><label>Mobile Number</label><input type="text" id="mobile" pattern="\d{10}" maxlength="10" required></div>
  </div>
  <div class="form-row">
    <div class="form-group"><label>Guarantor Name</label><input type="text" id="guarantorName" required></div>
    <div class="form-group"><label>Guarantor Mobile</label><input type="text" id="guarantorMobile" pattern="\d{10}" maxlength="10" required></div>
  </div>
  <div class="form-row">
    <div class="form-group"><label>Loan Amount (‚Çπ)</label><input type="number" id="loanAmount" min="0" required></div>
    <div class="form-group"><label>Loan Fees (‚Çπ)</label><input type="number" id="loanFees" min="0" required></div>
  </div>
  <div class="form-row">
    <div class="form-group"><label>Email</label><input type="email" id="email" placeholder="example@gmail.com" required></div>
    <div class="form-group"><label>Account Number</label><input type="text" id="accountNumber" placeholder="SRC1234" required></div>
  </div>
  <button type="submit">Register Loan</button>
</form>

<h2>Loan History</h2>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="Search by Name, Mobile or Loan ID...">
  <button type="button" id="searchBtn">üîç Search</button>
</div>

<table id="loanTable">
  <thead>
    <tr>
      <th>Loan ID</th>
      <th>Timestamp</th>
      <th>Name</th>
      <th>Aadhaar</th>
      <th>Mobile</th>
      <th>Guarantor</th>
      <th>Guarantor Mobile</th>
      <th>Loan Amount</th>
      <th>Loan Fees</th>
      <th>Email</th>
      <th>Account No.</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const form = document.getElementById('loanForm');
const tableBody = document.querySelector('#loanTable tbody');
const toggleBtn = document.getElementById('toggleFormBtn');
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwP8CYDgp0KpkdiBANCmpbJDrFVWuncaa5F95rzIiHbCl-Zr3RyBeFuuTRMHbPaqdT4/exec"; // ‡§Ö‡§™‡§®‡•Ä Web App URL ‡§°‡§æ‡§≤‡•á‡§Ç

let allLoans = [];

// Toggle Registration Form
toggleBtn.addEventListener('click', () => {
  form.style.display = form.style.display === "none" ? "block" : "none";
});

// Register Loan
form.addEventListener('submit', async e => {
  e.preventDefault();
  const data = {
    name: document.getElementById('name').value,
    aadhaar: document.getElementById('aadhaar').value,
    mobile: document.getElementById('mobile').value,
    guarantorName: document.getElementById('guarantorName').value,
    guarantorMobile: document.getElementById('guarantorMobile').value,
    loanAmount: document.getElementById('loanAmount').value,
    loanFees: document.getElementById('loanFees').value,
    email: document.getElementById('email').value,
    accountNumber: document.getElementById('accountNumber').value
  };
  const formData = new URLSearchParams();
  formData.append("action","register");
  for(let key in data) formData.append(key,data[key]);
  const res = await fetch(WEB_APP_URL, {method:'POST', body:formData});
  const result = await res.json();
  alert(result.message);
  loadData();
  form.reset();
  form.style.display = "none";
});

// Load Loan History
async function loadData(){
  try {
    const res = await fetch(WEB_APP_URL+"?action=get");
    allLoans = await res.json();
    renderTable(allLoans);
  } catch(err){
    console.error("Error fetching data:", err);
  }
}

// Render Table with Status Colors
function renderTable(data){
  tableBody.innerHTML='';
  data.forEach((r,index)=>{
    const tr=document.createElement('tr');

    // Row color based on status
    let bgColor = '';
    if(r.Status){
      const status = r.Status.toLowerCase();
      if(status === 'pending') bgColor = '#ffe5b4';   // light orange
      else if(status === 'approved') bgColor = '#d4edda'; // light green
      else if(status === 'rejected') bgColor = '#f8d7da'; // light red
    }
    tr.style.backgroundColor = bgColor;

    tr.innerHTML=`
      <td>${r.LoanID}</td>
      <td>${r.Timestamp}</td>
      <td>${r.Name}</td>
      <td>${r.Aadhaar}</td>
      <td>${r.Mobile}</td>
      <td>${r.GuarantorName}</td>
      <td>${r.GuarantorMobile}</td>
      <td>${r.LoanAmount}</td>
      <td>${r.LoanFees}</td>
      <td>${r.Email}</td>
      <td>${r.AccountNumber || ''}</td>
      <td>${r.Status || ''}</td>
      <td>
        ${r.Status && r.Status.toLowerCase()==="pending" ? `
          <button class="action-btn approve" onclick="updateStatus(${index},'approve')">Approve</button>
          <button class="action-btn reject" onclick="updateStatus(${index},'reject')">Reject</button>
        `:""}
      </td>
    `;
    tableBody.appendChild(tr);
  });
}

// Approve / Reject Loan
async function updateStatus(index,action){
  const formData = new URLSearchParams();
  formData.append("action",action);
  formData.append("rowIndex",index);
  const res = await fetch(WEB_APP_URL,{method:"POST", body:formData});
  const result = await res.json();
  alert(result.message);
  loadData();
}

// Search Function
function searchLoan(){
  const term = searchInput.value.trim().toLowerCase();
  if(!term) { renderTable(allLoans); return; }

  const filtered = allLoans.filter(r => {
    const name = r.Name ? r.Name.toLowerCase() : '';
    const mobile = r.Mobile ? r.Mobile.toString() : '';
    const loanId = r.LoanID ? r.LoanID.toLowerCase() : '';
    return name.includes(term) || mobile.includes(term) || loanId.includes(term);
  });

  renderTable(filtered);
}

// Search button click
searchBtn.addEventListener("click", searchLoan);

// Enter key on search input
searchInput.addEventListener("keypress", function(e){
  if(e.key === "Enter") {
    e.preventDefault();
    searchLoan();
  }
});

// Initial Load
loadData();
</script>

</body>
</html>
