<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shree Radha Credit Co-operative Society</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--maroon:#800000;--light:#a55252;--paper:#fff;--green:#1e9e55;--muted:#555}
    body{margin:0;font-family:Inter,Poppins,Arial,sans-serif;background:linear-gradient(180deg,#fff,#fffaf2);color:#222}
    header{background:linear-gradient(90deg,var(--maroon),var(--light));color:white;padding:18px 20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:16px;align-items:center}
    .logo{width:72px;height:72px;background:white;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--maroon);font-weight:700}
    .titles{line-height:1}
    .titles h1{margin:0;font-size:20px}
    .titles p{margin:2px 0 0;font-size:13px;opacity:0.95}
    .actions{font-size:14px}
    .agent-panel{background:#fff;color:var(--maroon);padding:10px 14px;border-radius:50%;font-weight:bold;cursor:pointer;font-size:18px;box-shadow:0 2px 6px rgba(0,0,0,0.2);transition:0.3s}
    .agent-panel:hover{transform:scale(1.1);background:#f4f4f4}
    .container{max-width:900px;margin:20px auto;padding:10px}
    .panel{display:none;background:#fff;padding:25px;border-radius:14px;box-shadow:0 8px 28px rgba(0,0,0,0.1);margin-bottom:20px;animation:fadeIn 0.6s ease}
    .panel.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    input,select,button{width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:10px;font-size:15px;outline:none;transition:0.3s}
    input:focus,select:focus{border-color:var(--maroon);box-shadow:0 0 6px rgba(128,0,0,0.5)}
    button{background:var(--green);color:#fff;cursor:pointer;border:none;font-weight:600;transition:0.3s;border-radius:25px}
    button:hover{background:#167a40;transform:translateY(-2px)}
    .welcome-btn{background:var(--maroon);color:#fff}
    .welcome-btn:hover{background:#a52a2a;transform:translateY(-2px)}
    .heading{font-family:'Merriweather',serif;font-size:20px;font-weight:700;margin-bottom:15px;color:var(--maroon);text-align:center}
    #balance{font-size:18px;font-weight:bold;margin:14px 0;text-align:center;color:var(--maroon)}
    .action-buttons{margin:20px 0;text-align:center}
    .action-buttons button{width:80%;margin:8px auto;box-shadow:0 4px 12px rgba(0,0,0,0.15);font-size:16px;padding:14px}
    footer{text-align:center;padding:15px;background:var(--light);color:white;margin-top:30px;font-size:13px}
    @media(max-width:720px){.brand{flex-direction:column;align-items:flex-start}.logo{width:56px;height:56px}.titles h1{font-size:18px}.titles p{font-size:12px}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">SRCCS</div>
      <div class="titles">
        <h1>Shree Radha Credit Co-operative Society Ltd.</h1>
        <p>Guji (Dhamnod), Sub district Dharmapuri, District Dhar - 454552</p>
        <p style="font-size:12px;margin-top:6px;opacity:0.92">
          Reg. No: DR/DHR/151716 ¬∑ Customer & Agent Portal
        </p>
      </div>
    </div>
    <div class="actions">
      <div class="agent-panel" onclick="showPanel('agentLogin')">üîê</div>
    </div>
  </header>

  <div class="container">
    <div class="action-buttons">
      <button class="welcome-btn" onclick="showPanel('customerLogin')">‚ú® ‚Äú‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à üôè, ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∏‡•á‡§µ‡§æ ‡§Æ‡•á‡§Ç üíª‚Äù ‚ú®</button>
    </div>

    <!-- Customer Login -->
    <div id="customerLogin" class="panel active">
      <div class="heading">üîë Customer Login</div>
      <input id="cAccount" placeholder="Account Number (e.g. SRC1234)" required>
      <input id="cPass" placeholder="Password (Last 4 digits)" required>
      <button id="cLoginBtn" onclick="customerLogin()">Check Account Balance</button>
    </div>

    <!-- Customer Panel -->
    <div id="customerPanel" class="panel">
      <div class="heading">üë§ Welcome Customer</div>
      <p id="balance">Balance: ‚Çπ0</p>
      <p><b>Provided by: Shree Radha Credit Co-operative Society Ltd.</b></p>
      <button id="downloadBtn" onclick="downloadStatement()">üìÑ Download Statement (PDF)</button>
    </div>

    <!-- Agent Login -->
    <div id="agentLogin" class="panel">
      <div class="heading">üõ°Ô∏è Agent Security</div>
      <input id="aCode" placeholder="Enter Security Code" required>
      <button id="aLoginBtn" onclick="agentAuth()">Continue</button>
    </div>

    <!-- Agent Panel -->
    <div id="agentPanel" class="panel">
      <div class="heading">üíº Agent Transaction</div>

      <!-- Account Number with SRC prefix -->
      <label for="aAccount">Account Number</label>
      <div style="display:flex;align-items:center;">
        <span style="padding:12px;background:#eee;border:1px solid #ccc;border-right:none;border-radius:10px 0 0 10px;font-weight:bold;">SRC</span>
        <input id="aAccount" maxlength="4" pattern="[0-9]{4}" placeholder="Enter 4 digits" style="flex:1;border-radius:0 10px 10px 0;" required>
      </div>

      <!-- Amount -->
      <input id="aAmount" type="number" placeholder="Amount" required>

      <!-- Transaction Type -->
      <select id="aType" required>
        <option value="">--Select Transaction--</option>
        <option value="credit">Credit</option>
        <option value="debit">Debit</option>
      </select>

      <!-- Agent ID Dropdown -->
      <select id="aID" required>
        <option value="">--Select Agent ID--</option>
        <option value="SH7333">SH7333</option>
        <option value="KA4564">KA4564</option>
      
        <option value="SRCCS1432">SRCCS1432</option>
      </select>

      <button id="aSubmitBtn" onclick="saveTransaction()">Submit</button>
      <p id="msg" style="text-align:center;color:green;font-weight:600;"></p>
      <p><b>Provided by: Shree Radha Credit Co-operative Society Ltd.</b></p>
    </div>
  </div>

  <footer>¬© 2025 Shree Radha Credit Co-operative Society Ltd. ‚Äî Reg. No: DR/DHR/151716 ‚Äî Gujri, Madhya Pradesh</footer>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <script>
    const API_URL="https://script.google.com/macros/s/AKfycby4_JhyXSQUj1VrViySeAhxvQYw86HUxhcNlAvKdJzAJmOLUT-zF5EDW3WaP88-gvW9/exec";
    const SECURITY_CODE="9754";

    function showPanel(id){
      document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function customerLogin(){
      let acc=document.getElementById("cAccount").value.trim();
      let pass=document.getElementById("cPass").value;
      if(!acc||!pass){alert("‚ö†Ô∏è Please fill all fields!");return;}
      let btn=document.getElementById("cLoginBtn");
      btn.disabled=true;btn.innerText="‚è≥ Please wait...";
      fetch(`${API_URL}?fn=checkCustomer&account=${acc}&pass=${pass}`)
      .then(res=>res.json())
      .then(data=>{
        if(data.success){
          showPanel("customerPanel");
          document.getElementById("balance").innerText="Balance: ‚Çπ"+data.balance;
        }else{
          alert("Invalid Account/Password ‚ùå");
          document.getElementById("cAccount").value="";
          document.getElementById("cPass").value="";
        }
      })
      .catch(()=>alert("Error connecting to server!"))
      .finally(()=>{btn.disabled=false;btn.innerText="Check Account Balance";});
    }

    async function downloadStatement(){
      let acc=document.getElementById("cAccount").value.trim();
      let pass=document.getElementById("cPass").value;
      let btn=document.getElementById("downloadBtn");
      btn.disabled=true;btn.innerText="‚è≥ Please wait...";
      try{
        const res=await fetch(`${API_URL}?fn=getHistory&account=${acc}&pass=${pass}`);
        const data=await res.json();
        if(!data.success){alert("Unable to fetch statement ‚ùå");location.reload();return;}
        const { jsPDF }=window.jspdf;const doc=new jsPDF();
        doc.setFontSize(16);doc.text("Shree Radha Credit Co-operative Society Ltd., Gujri (Dhamnod)",14,20);
        doc.setFontSize(12);
        doc.text(`Account: ${acc}`,14,28);
        doc.text(`Balance: ‚Çπ${data.balance}`,14,36);
        doc.text(`Date: ${new Date().toLocaleString()}`,14,44);
        const tableColumn=["Date & Time","Amount","Type","Agent"];
        const tableRows=[];data.transactions.forEach(trx=>{tableRows.push([trx.date,`‚Çπ${trx.amount}`,trx.type,trx.agent||"-"]);});
        doc.autoTable({startY:50,head:[tableColumn],body:tableRows});
        doc.save(`Statement_${acc}.pdf`);
        location.reload();
      }catch(err){alert("Error generating PDF ‚ùå");location.reload();}
      finally{btn.disabled=false;btn.innerText="üìÑ Download Statement (PDF)";}
    }

    function agentAuth(){
      let code=document.getElementById("aCode").value;
      if(!code){alert("‚ö†Ô∏è Enter Security Code!");return;}
      let btn=document.getElementById("aLoginBtn");
      btn.disabled=true;btn.innerText="‚è≥ Checking...";
      setTimeout(()=>{
        if(code===SECURITY_CODE){showPanel("agentPanel");}
        else{alert("Wrong Security Code ‚ùå");}
        btn.disabled=false;btn.innerText="Continue";
      },800);
    }

    function saveTransaction(){
      let accSuffix=document.getElementById("aAccount").value.trim();
      let amt=document.getElementById("aAmount").value;
      let type=document.getElementById("aType").value;
      let id=document.getElementById("aID").value;

      if(accSuffix.length!==4 || isNaN(accSuffix)){
        alert("‚ö†Ô∏è ‡§ï‡•É‡§™‡§Ø‡§æ 4 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ Account Number ‡§°‡§æ‡§≤‡•á‡§Ç!");
        return;
      }
      if(!amt||!type||!id){
        alert("‚ö†Ô∏è Please fill all fields!");
        return;
      }

      let acc="SRC"+accSuffix; // Final Account Number

      let btn=document.getElementById("aSubmitBtn");
      btn.disabled=true;btn.innerText="‚è≥ Saving...";

      fetch(API_URL,{
        method:"POST",
        body:JSON.stringify({fn:"transaction",account:acc,amount:amt,type:type,agent:id})
      })
      .then(res=>res.json())
      .then(data=>{
        document.getElementById("msg").innerText=data.message;
        document.getElementById("aAccount").value="";
        document.getElementById("aAmount").value="";
        document.getElementById("aID").value="";
        document.getElementById("aType").value="";
        setTimeout(()=>document.getElementById("msg").innerText="",4000);
      })
      .catch(()=>alert("Error connecting to server!"))
      .finally(()=>{btn.disabled=false;btn.innerText="Submit";});
    }

    document.addEventListener("keypress",function(e){
      if(e.key==="Enter"){
        let active=document.querySelector(".panel.active");
        if(active.id==="customerLogin")customerLogin();
        else if(active.id==="agentLogin")agentAuth();
        else if(active.id==="agentPanel")saveTransaction();
      }
    });
  </script>
</body>
</html>


